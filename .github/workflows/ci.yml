name: CI

on:
  push:
    branches: [main]
    paths-ignore:
      - README.md

jobs:
  fedora-job:
    runs-on: ubuntu-latest
    container: fedora:39
    permissions:
      contents: write
    steps:
      - run: cat /etc/os-release
      - run: df
      - run: dnf install -y curl dnf-utils rpm-build
      - run: curl -o a.rpm https://kojipkgs.fedoraproject.org//packages/chromium/120.0.6099.129/1.fc39/src/chromium-120.0.6099.129-1.fc39.src.rpm
      - run: ls -l a.rpm
      - run: dnf builddep -y --srpm a.rpm
      - run: df
      - run: rpm -ivh a.rpm
      - run: rm a.rpm
      - uses: actions/checkout@v4
      - run: patch ~/rpmbuild/SPECS/chromium.spec chromium.spec.diff
#      - run: pushd ~/rpmbuild/SPECS/ && rpmbuild -bp chromium.spec && popd
#      - run: find ~/rpmbuild/BUILD -type d -name 'third_*' -print -exec ls -l {} \;
#      - run: find ~/rpmbuild/BUILD -depth -type d -name 'third_*' -exec du {} \;
#      - run: du -s ~/rpmbuild/BUILD/chromium-*/third_party/*
#      - run: du -s ~/rpmbuild/BUILD/chromium-*/third_party/*/third_party
#      - run: du -s ~/rpmbuild/BUILD/chromium-*
#      - run: df
      - run: pushd ~/rpmbuild/SPECS/ && rpmbuild -bc chromium.spec && popd
      - uses: actions/upload-artifact@v3
        with:
          name: before
          path: before.tgz
